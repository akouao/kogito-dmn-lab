apiVersion: 1.0.0
metadata:
  name: kogito-dmn
projects:
  - name: kogito-dmn
    source:
      location: 'https://github.com/akouao/kogito-dmn-lab.git'
      type: git
components:
  - id: redhat/quarkus-java11/latest
    type: chePlugin
  - mountSources: true
    endpoints:
      - attributes:
          path: /swagger-ui
        name: swagger-ui
        port: 8080
    memoryLimit: 4Gi
    type: dockerimage
    alias: quarkus-tools
    image: >-
      image-registry.openshift-image-registry.svc:5000/openshift/quarkus-stack:2.1
    env:
      - value: /home/jboss/.m2
        name: MAVEN_CONFIG
      - value: >-
          -Xmx4G -Xss128M -XX:MetaspaceSize=1G -XX:MaxMetaspaceSize=2G
          -XX:+CMSClassUnloadingEnabled
        name: MAVEN_OPTS
commands:
  - name: Start Live Coding
    actions:
      - workdir: '${CHE_PROJECTS_ROOT}'
        type: exec
        command: >-
          mvn clean compile quarkus:dev -f
          ${CHE_PROJECTS_ROOT}/kogito-dmn-lab/airmiles-service
        component: quarkus-tools
  - name: Package Application
    actions:
      - workdir: '${CHE_PROJECTS_ROOT}'
        type: exec
        command: >-
          mvn package -DuberJar=true -DskipTests=true -f
          ${CHE_PROJECTS_ROOT}/kogito-dmn-lab/airmiles-service
        component: quarkus-tools
  - name: Build Native App
    actions:
      - workdir: '${CHE_PROJECTS_ROOT}'
        type: exec
        command: >-
          mvn package -Pnative -DskipTests -f
          ${CHE_PROJECTS_ROOT}/kogito-dmn-lab/airmiles-service
        component: quarkus-tools